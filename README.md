# Gmailアドオン：メール内容をもとにGoogleカレンダーに予定作成

このスクリプトは **Gmail の任意のメールを開いた状態から、その内容を使って Google カレンダーに予定を作成**する Gmail アドオンです。
**iPhone の Gmail**でも動作し、**作成先カレンダーの選択・開始/終了の分単位指定・説明への本文貼り付け**ができます。作成後は完了カードを表示します。

## できること

* メールを開いた画面下部のアドオンから、**そのメールを元に予定を作成**
* **カレンダー選択**（自分のメイン／所有カレンダーから選択）
* **開始・終了を分単位で指定**（初期値は「今+15分〜今+45分」＝30分枠）
* **説明欄に本文の先頭とメールのパーマリンク**を自動挿入
* 作成後は **「予定作成完了」カード**を表示

> 補足：Gmail アドオンは仕様上、ペインをプログラムで完全に閉じることはできません。完了カードの表示／ナビゲーションで「閉じた風」の体験を作ります。

## ファイル構成

* `Code.gs` … 本体（あなたが貼り付けたコード）
* `appsscript.json` … マニフェスト（後述の例を推奨）
* `logo.png`  … アドオン用アイコン

## 必要な権限（Scopes）

`appsscript.json` には少なくとも以下のスコープが必要です。

```json
"oauthScopes": [
  "https://www.googleapis.com/auth/gmail.addons.execute",
  "https://www.googleapis.com/auth/gmail.addons.current.message.readonly",
  "https://www.googleapis.com/auth/calendar"
]
```

* `gmail.addons.current.message.readonly` … 開いている **その** メールの件名・本文を読むため
* `gmail.addons.execute` … アドオン実行の基本権限
* `calendar` … 予定の作成

## セットアップ手順

1. **Apps Script プロジェクト作成**

   * ブラウザで `script.new` を開き、`Code.gs` に提供のコードを貼る。
   * （任意）`appsscript.json` を編集してテーマ色やアイコンを設定（例は後述）。

2. **テストとして導入**

   * 右上の **［デプロイ］→［デプロイをテスト］→［インストール］**。
   * 権限承認ダイアログで Gmail/Calendar へのアクセスを許可。

3. **動作確認**

   * 同じアカウントで Gmail（iPhone/デスクトップ）を開き、任意のメールを開く。
   * アドオンのアイコン（iPhone はスレッド最下部、PC は右サイドバー）から起動。
   * カレンダー・開始/終了・説明を確認し、**［カレンダーに予定を作成］** を押す。
   * 「予定作成完了」カードが表示されれば成功。

## 使い方（操作フロー）

1. Gmail で予定化したいメールを開く
2. アドオンを起動 → **カレンダー選択**／**タイトル**／**開始**／**終了**／**説明** を確認
3. **［カレンダーに予定を作成］** を押す
4. **「予定作成完了」カード**が出たら終了（Google カレンダーに登録済み）

## TODO

- [ ] IOS版Gmail上で、ボタンを複数回押下できないようにする（多重登録防止）
   - GASでUI制御する方法がよくわからない。。。
   - Windows11, Edge上のGmailならローディング処理が勝手に走る。

## 備考

* 本アドオンはあなたの Google アカウント範囲で動作します。第三者への公開は Google Workspace Marketplace のポリシーに従ってください。
* メール本文はアドオン実行時に一時的に読み取り、予定説明へ挿入します。サーバ等へ保存はしません。

